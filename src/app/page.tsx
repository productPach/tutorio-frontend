import { Header } from "@/components/Header/Header";
import { Index } from "@/components/Landing/Index/Index";
import { Footer } from "@/components/Footer/Footer";
import { fetchDetectUserRegion } from "@/api/server/locationApi";
import { Metadata } from "next";
import { redirect } from "next/navigation";

// export const metadata = {
//   title: "Tutorio ‚Äî –ø–æ–¥–±–æ—Ä —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–≤ –∏ –ø–æ–∏—Å–∫ —É—á–µ–Ω–∏–∫–æ–≤ –æ–Ω–ª–∞–π–Ω",
//   description:
//     "Tutorio ‚Äî –æ–Ω–ª–∞–π–Ω-—Å–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–≤ –∏ —É—á–µ–Ω–∏–∫–æ–≤. –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ, —Ä—É—Å—Å–∫–æ–º—É, –∞–Ω–≥–ª–∏–π—Å–∫–æ–º—É –∏ –¥—Ä—É–≥–∏–º –ø—Ä–µ–¥–º–µ—Ç–∞–º. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ï–ì–≠, –û–ì–≠ –∏ –ø–æ–º–æ—â—å —Å –¥–æ–º–∞—à–Ω–∏–º–∏ –∑–∞–¥–∞–Ω–∏—è–º–∏.",
//   keywords: [
//     "–ø–æ–∏—Å–∫ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞",
//     "–ø–æ–¥–±–æ—Ä —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞",
//     "–Ω–∞–π—Ç–∏ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞ –æ–Ω–ª–∞–π–Ω",
//     "—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ",
//     "—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä –ø–æ —Ä—É—Å—Å–∫–æ–º—É —è–∑—ã–∫—É",
//     "—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä –ø–æ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º—É",
//     "–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ï–ì–≠",
//     "–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –û–ì–≠",
//     "–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –í–ü–†",
//     "–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —à–∫–æ–ª–µ",
//     "—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞",
//     "–æ–Ω–ª–∞–π–Ω —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä",
//     "–¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ",
//     "–ø–æ–º–æ—â—å —Å –¥–∑",
//     "–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ç–µ–º—ã",
//     "–∑–∞–Ω—è—Ç–∏—è –æ–Ω–ª–∞–π–Ω",
//     "–∑–∞–Ω—è—Ç–∏—è —Å —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–º",
//     "–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É—Ä–æ–∫–∏",
//     "–æ–±—É—á–µ–Ω–∏–µ —à–∫–æ–ª—å–Ω–∏–∫–æ–≤",
//     "—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä—Å–∫–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞",
//     "–Ω–∞–π—Ç–∏ —É—á–µ–Ω–∏–∫–∞",
//     "Tutorio",
//     "–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å",
//     "—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä—Å–∫–∞—è –ø–æ–º–æ—â—å",
//     "–¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ",
//     "–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —ç–∫–∑–∞–º–µ–Ω–∞–º",
//     "–æ–±—É—á–µ–Ω–∏–µ –æ–Ω–ª–∞–π–Ω",
//     "—É—Ä–æ–∫–∏ –ø–æ Zoom",
//     "—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤",
//     "—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä –ø–æ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–µ",
//     "—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä –ø–æ —Ö–∏–º–∏–∏",
//     "—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä –ø–æ —Ñ–∏–∑–∏–∫–µ",
//     "—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä –ø–æ –±–∏–æ–ª–æ–≥–∏–∏",
//     "—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä –ø–æ –∏—Å—Ç–æ—Ä–∏–∏",
//     "—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä –ø–æ –æ–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏—é",
//     "–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è",
//     "—Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä –Ω–µ–¥–æ—Ä–æ–≥–æ",
//     "–ª—É—á—à–∏–µ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä—ã",
//     "–ø–æ–∏—Å–∫ —É—á–µ–Ω–∏–∫–æ–≤",
//   ],
// };

// ‚úÖ –û–¥–∏–Ω –≤—ã–∑–æ–≤ –Ω–∞ –≤–µ—Å—å –∑–∞–ø—Ä–æ—Å
let regionData: any = null;

async function getRegionData() {
  if (regionData) return regionData; // –ö–µ—à–∏—Ä—É–µ–º –Ω–∞ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞

  try {
    regionData = await fetchDetectUserRegion({ set_cookie: true });
    return regionData;
  } catch (err) {
    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ —Ä–µ–≥–∏–æ–Ω–∞:", err);
    return null;
  }
}

export async function generateMetadata(): Promise<Metadata> {
  const region = await getRegionData();

  if (!region) {
    return {
      title: "Tutorio ‚Äî —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä—ã –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏",
      description: "–ù–∞–π–¥–∏ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞ –¥–ª—è –∑–∞–Ω—è—Ç–∏–π –≤ –ª—é–±–æ–º —Ä–µ–≥–∏–æ–Ω–µ –†–æ—Å—Å–∏–∏",
    };
  }

  return {
    title: `–†–µ–ø–µ—Ç–∏—Ç–æ—Ä—ã –≤ ${region.region_name_dative} ‚Äî Tutorio`,
    description: `–ù–∞–π–¥–∏ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞ –¥–ª—è –∑–∞–Ω—è—Ç–∏–π –≤ ${region.region_name_dative}`,
  };
}

export default async function Home() {
  const region = await getRegionData();
  console.log("üìç Region data:", region);
  console.log("üìç Region slug:", region?.slug);

  if (region && region.slug !== "msk") {
    console.log("üîÑ Redirecting to:", `/${region.slug}`);
    redirect(`/${region.slug}`);
  }

  return (
    <>
      <Header />
      <Index />
      <Footer />
    </>
  );
}
